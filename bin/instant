#!/usr/bin/env node

var instant = require('instant')
  , connect = require('connect')
  , linger = require('linger')
  , minimist = require('minimist')
  , open = require('open')
  , serveIndex = require('serve-index')

var argv = minimist(process.argv.slice(2), {
  boolean: 'quiet',
  alias: {
    quiet: 'q'
  }
})

var port = argv._[0]
var root = process.cwd()
var app = connect()

console.log(argv)

app
.use(instant({ root: root, delay: argv.delay }))
.use(serveIndex(root, { icons: true, hidden: true }))
.listen(port, function() {
  var listening = this.address().port
  if (!port) open('http://localhost:' + listening)
  if (argv.quiet && !port)
  console.log('listening on port ' + listening + ' and waiting for changes')
  else if (!argv.quiet)
  linger('listening on port ' + listening + ' and waiting for changes')
})
